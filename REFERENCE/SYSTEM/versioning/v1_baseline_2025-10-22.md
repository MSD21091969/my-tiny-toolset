# v1 Baseline Snapshot (2025-10-22)

**Last updated:** 2025-10-22  
**Status:** Active Baseline  
**Scope:** Methods, Models, Tools, Classification

---

## Overview

This document captures the **v1 baseline snapshot** of the Tiny Data Collider API contracts.

**Baseline Date:** 2025-10-22  
**Total Methods:** 28  
**Total Models:** 121 (Pydantic)  
**Total Tool YAMLs:** 28  
**Infrastructure Version:** v0.7.0-dev  
**Contracts Version:** v1.0.0

**Purpose:**
- Freeze v1 API contracts (methods, models, tool definitions)
- Enable infrastructure evolution without breaking contracts
- Establish CI/CD drift detection baseline
- Document known limitations and future work

---

## Method Inventory (28 Methods)

### By Domain
- **workspace** (12 methods): Casefile management, ACL, Google Workspace sync
- **communication** (6 methods): Chat sessions, Gmail operations
- **automation** (10 methods): Tool execution, orchestration

### By Capability
- **create** (8 methods): Create new resources
- **read** (7 methods): Retrieve existing resources
- **update** (3 methods): Modify existing resources
- **delete** (2 methods): Remove resources
- **search** (4 methods): Query and filter
- **process** (4 methods): Execute business logic

### By Complexity
- **atomic** (18 methods): Single operation, no orchestration
- **composite** (8 methods): 2-5 orchestrated steps
- **pipeline** (2 methods): Complex multi-stage workflows

### By Integration Tier
- **internal** (17 methods): Implemented in application services
- **external** (6 methods): Thin wrappers around Google APIs
- **hybrid** (5 methods): Internal logic + external calls

### Complete Method List

#### Workspace Domain (12)
1. `casefile_create_casefile` (internal, atomic, stable)
2. `casefile_get_casefile` (internal, atomic, stable)
3. `casefile_update_casefile` (internal, atomic, stable)
4. `casefile_delete_casefile` (internal, atomic, stable)
5. `casefile_search_casefiles` (internal, composite, stable)
6. `casefile_add_session_to_casefile` (internal, composite, stable)
7. `casefile_acl_check_permission` (internal, atomic, stable)
8. `casefile_acl_grant_permission` (internal, atomic, stable)
9. `casefile_acl_revoke_permission` (internal, atomic, stable)
10. `workspace_sync_folder` (external, atomic, stable)
11. `workspace_create_folder` (external, atomic, stable)
12. `workspace_list_files` (external, atomic, stable)

#### Communication Domain (6)
13. `chat_create_session` (internal, atomic, stable)
14. `chat_get_session` (internal, atomic, stable)
15. `communication_process_chat_request` (hybrid, pipeline, stable)
16. `gmail_send_message` (external, atomic, stable)
17. `gmail_search_messages` (external, composite, stable)
18. `gmail_get_message` (external, atomic, stable)

#### Automation Domain (10)
19. `toolsession_create_tool_session` (internal, atomic, stable)
20. `toolsession_get_tool_session` (internal, atomic, stable)
21. `toolsession_update_tool_session` (internal, atomic, stable)
22. `toolsession_delete_tool_session` (internal, atomic, stable)
23. `toolsession_execute_tool` (hybrid, composite, stable)
24. `orchestration_create_workflow` (internal, composite, beta)
25. `orchestration_execute_workflow` (hybrid, pipeline, beta)
26. `orchestration_validate_workflow` (internal, atomic, beta)
27. `method_search` (internal, atomic, beta)
28. `method_get_details` (internal, atomic, beta)

---

## Model Inventory (121 Pydantic Models)

### Auto-Generated Documentation
- **Location:** `REFERENCE/SYSTEM/model-docs/` (toolset repo)
- **Generator:** `TOOLSET/documentation-tools/model_docs_generator.py`
- **Last Generated:** 2025-10-22
- **Format:** Markdown with field specs, validators, examples

### Model Categories
1. **Request Models:** Input schemas for methods (create, update, search)
2. **Response Models:** Output schemas with casefile, session, tool data
3. **Base Models:** Shared types, enums, custom validators
4. **Service Models:** Internal persistence layer models
5. **Tool Models:** Tool execution, session management

### Custom Types (from `custom_types.py`)
- `CasefileId`, `SessionId`, `ToolName`, `Timestamp`
- `Username`, `Email`, `Permission`
- `NonEmptyStr`, `PositiveInt`, `SortOrder`

### Key Models (Most Referenced)
1. `CreateCasefileRequest` / `CasefileResponse`
2. `CreateToolSessionRequest` / `ToolSessionResponse`
3. `ProcessChatRequest` / `ProcessChatResponse`
4. `ExecuteToolRequest` / `ExecuteToolResponse`
5. `SearchCasefilesRequest` / `SearchCasefilesResponse`

---

## Tool YAML Inventory (28 Files)

### Location
- `config/methodtools_v1/` (28 files, 1:1 mapping to methods)

### Structure (Example: `casefile_create_casefile_tool.yaml`)
```yaml
name: casefile_create_casefile
version: "1.0.0"
method_name: casefile_create_casefile
description: "Create a new casefile with title, description, and tags"
request_model: CreateCasefileRequest
response_model: CasefileResponse
implementation:
  class: CasefileService
  method: create_casefile
classification:
  domain: workspace
  subdomain: casefile
  capability: create
  complexity: atomic
  maturity: stable
  integration_tier: internal
```

### Validation Status
- ✅ All 28 YAMLs exist
- ⏳ Not yet validated with `methodtools_validator.py` (Phase 9 pending)

---

## Classification Taxonomy (v1)

### Domains (3)
- `workspace`: Casefile, ACL, Google Workspace
- `communication`: Chat, Gmail
- `automation`: Tools, orchestration

### Capabilities (6)
- `create`, `read`, `update`, `delete`, `search`, `process`

### Complexity (3)
- `atomic` (1 operation), `composite` (2-5 operations), `pipeline` (5+ operations)

### Maturity (4)
- `alpha`, `beta`, `stable`, `deprecated`

### Integration Tier (3)
- `internal` (app services), `external` (Google APIs), `hybrid` (both)

**Full Taxonomy:** See `config/classification_taxonomy_v1.yaml`

---

## Known Limitations

### 1. External API Validation Gap
**Problem:** External methods (Gmail, Google Workspace) not validated at startup.

**Current State:**
- Internal methods: Validated via `MANAGED_METHODS` registry (decorator-based)
- External methods: Imported at runtime via `service_module_map`
- **Gap:** If external method renamed/removed, startup succeeds but runtime fails

**Example:**
```python
# If Google API changes gmail_send_message → send_email
# App starts fine, but tool execution fails at runtime
```

**Impact:**
- External methods: 6 (gmail_*, workspace_*)
- Hybrid methods: 5 (call external APIs internally)
- Total affected: 11 / 28 methods (39%)

**Mitigation:**
- Document all external methods in `methods_inventory_v1.yaml`
- Use `drift_detector.py` to catch missing methods
- Manual testing of external methods in staging

**Long-term Fix (v2):**
- Validate external methods at startup (import all, check callable)
- Create mock implementations for unit testing
- Add external API health checks to startup sequence

---

### 2. Workflow Composition Not Versioned
**Problem:** Workflows in `config/workflows/` not versioned like methods/tools.

**Current State:**
- Methods: Versioned (methods_inventory_v1.yaml)
- Tools: Versioned (methodtools_v1/)
- Workflows: No version (dynamic composition)

**Impact:**
- Workflow YAMLs can drift from methods
- Breaking method changes don't propagate to workflows
- No CI/CD validation for workflow correctness

**Mitigation:**
- Use `workflow_validator.py` to validate workflows manually
- Keep workflows simple (2-3 steps max)
- Document workflow dependencies in method docs

**Long-term Fix (v2):**
- Version workflows (workflows_v1/)
- Add workflow validation to CI/CD
- Create workflow schema for validation

---

### 3. No Deprecation Policy Yet
**Problem:** No formal process for deprecating methods/models.

**Current State:**
- Classification supports `deprecated` maturity level
- No deprecation tracking in code
- No migration guides

**Impact:**
- Can't safely remove methods in future versions
- No warning to developers using deprecated methods
- Risk of breaking existing tool YAMLs

**Mitigation:**
- Don't deprecate anything in v1 (freeze baseline)
- Plan deprecations for v2

**Long-term Fix (v2):**
- Add deprecation decorators to methods
- Track deprecated methods in `methods_inventory_v2.yaml`
- Generate deprecation warnings at runtime
- Require migration guides for breaking changes

---

### 4. Model Specification Not Auto-Validated
**Problem:** `models_specification_v1.yaml` not yet generated or validated.

**Current State:**
- Tool exists: `model_spec_extractor.py`
- Not yet run against codebase
- Manual model documentation in `REFERENCE/SYSTEM/model-docs/`

**Impact:**
- Can't detect model drift automatically
- No CI/CD validation for model field changes
- Manual process to keep model docs current

**Mitigation:**
- Use `model_docs_generator.py` to keep docs current
- Manual review of model changes in PRs

**Long-term Fix (Phase 9 completion):**
- Generate `models_specification_v1.yaml`
- Add model drift detection to CI/CD
- Validate tool YAMLs reference correct models

---

## Toolset Configuration (21 Tools)

### Production Tools (12 Core)
**Analysis (4):**
- `version_tracker.py` - Full analysis + Git history
- `code_analyzer.py` - Quick structure analysis
- `mapping_analyzer.py` - Relationship mapping
- `excel_exporter.py` - Report generation

**Workflow (3):**
- `method_search.py` - Method discovery
- `workflow_validator.py` - Comprehensive validation
- `composite_tool_generator.py` - Workflow generation

**Documentation (1):**
- `model_docs_generator.py` - Auto-generate model docs

**Validation (4):**
- `methods_inventory_validator.py` - Validate inventory
- `drift_detector.py` - CI/CD drift checks
- `methodtools_validator.py` - Validate tool YAMLs
- `model_spec_extractor.py` - Generate model specs

### Archived Tools (9 Optional)
- Moved to `/archive/` for specialized use cases
- See `TOOLSET/archive/README.md` for details

---

## Validation Status

### ✅ Completed
- [x] Methods inventory created (28 methods)
- [x] Tool YAMLs exist (28 files)
- [x] Classification taxonomy defined
- [x] Model docs generated (121 models)
- [x] Validation tools created (4 tools)

### ⏳ Pending (Phase 9 Completion)
- [ ] Generate `models_specification_v1.yaml`
- [ ] Validate all 28 methodtools YAMLs
- [ ] Test drift detector against inventory
- [ ] Setup CI/CD validation pipeline
- [ ] Document external API validation gap

### 🔄 Future Work (v1.1 or v2)
- [ ] Fix external API validation gap
- [ ] Version workflow compositions
- [ ] Implement deprecation policy
- [ ] Auto-validate model specifications
- [ ] Add workflow validation to CI/CD

---

## File Locations

### Application Repo (`my-tiny-data-collider`)
```
config/
  ├── methods_inventory_v1.yaml        ← Method catalog (28 methods)
  ├── classification_taxonomy_v1.yaml  ← Taxonomy definitions
  ├── methodtools_v1/                  ← Tool YAMLs (28 files)
  └── workflows/                       ← Workflow compositions (unversioned)

docs/
  ├── ARCHITECTURE_ORCHESTRATION.md    ← System design
  └── VALIDATION_PATTERNS.md           ← Custom types, validators

ROUNDTRIP_ANALYSIS.md                  ← Progress tracking
```

### Toolset Repo (`my-tiny-toolset`)
```
TOOLSET/
  ├── analysis-tools/        (4 tools)
  ├── workflow-tools/        (3 core, 4 archived)
  ├── documentation-tools/   (1 core, 5 archived)
  └── validation-tools/      (4 tools)

REFERENCE/SYSTEM/
  ├── model-docs/            ← 121 model markdown files
  └── versioning/
      ├── v1_baseline_2025-10-22.md    ← This file
      ├── version_strategy.md          ← Versioning policy
      └── classification_taxonomy_v1.yaml (copy)
```

---

## Next Steps (Phase 9 Completion)

### Immediate Actions
1. Run `model_spec_extractor.py` → Generate `models_specification_v1.yaml`
2. Run `methodtools_validator.py` → Validate all 28 tool YAMLs
3. Run `drift_detector.py` → Test baseline (should show zero drift)
4. Run `methods_inventory_validator.py` → Validate inventory consistency

### CI/CD Integration
```yaml
# .github/workflows/validate-contracts.yml
- name: Validate v1 contracts
  run: |
    python $TOOLSET/validation-tools/drift_detector.py \
      --inventory config/methods_inventory_v1.yaml \
      --ci-mode
    
    python $TOOLSET/validation-tools/methodtools_validator.py \
      --inventory config/methods_inventory_v1.yaml \
      --tools-dir config/methodtools_v1 \
      --ci-mode
```

### Documentation Updates
- Update `README.md` with v1 baseline reference
- Update `ROUNDTRIP_ANALYSIS.md` with Phase 9 completion
- Update `TOOLSET/README.md` with tool cleanup

---

## Version History

### v1.0.0 (2025-10-22)
- Initial baseline snapshot
- 28 methods documented
- 121 models cataloged
- 28 tool YAMLs created
- Classification taxonomy established
- 4 validation tools operational

---

*Last updated: 2025-10-22 - Part of Phase 9 (Toolset v1 Baseline)*
